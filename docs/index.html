<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>JoyRL æ–‡æ¡£</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="description" content="JoyRL æ–‡æ¡£" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0" />

  <!-- ========== Docsify Theme (Light/Dark) ========== -->
  <link
    rel="stylesheet"
    media="(prefers-color-scheme: dark)"
    href="https://cdn.jsdelivr.net/npm/docsify-themeable@0/dist/css/theme-simple-dark.css"
  />
  <link
    rel="stylesheet"
    media="(prefers-color-scheme: light)"
    href="https://cdn.jsdelivr.net/npm/docsify-themeable@0/dist/css/theme-simple.css"
  />

  <style>
    /* =============== åŸºç¡€ä¸»é¢˜è°ƒæ•´ =============== */
    :root {
      /* éœ€è¦å¯ä»¥å¼€å¯ä¸»é¢˜ä¸»è‰²ï¼š */
      /* --theme-hue: 325; */
    }

    /* =============== Giscus å¸ƒå±€ä¿®å¤ï¼ˆä¸ä½ åŸé€»è¾‘ä¿æŒä¸€è‡´ï¼‰ =============== */
    #giscus-comments {
      max-width: 800px;
      width: 100%;
      margin: 2em auto;
      padding: 0;
      box-sizing: border-box;
      display: block;
      position: relative;
      z-index: 0;
    }

    .sidebar,
    .sidebar-toggle,
    .docsify-toc {
      position: relative;
      z-index: 20 !important;
    }

    .giscus,
    .giscus-frame {
      position: relative !important;
      z-index: 0 !important;
    }

    @media (max-width: 900px) {
      #giscus-comments {
        width: 100%;
        margin: 1.5em 0.5em;
      }
    }

    /* ä¼˜åŒ– MathJax æ˜¾ç¤º */
    mjx-container[jax="SVG"][display="true"] {
      text-align: center;
      margin: 1em 0;
    }

    /* éšè— docsify ä¸»é¢˜é»˜è®¤çš„ > ç®­å¤´ç¬¦å·ï¼Œåªä¿ç•™æŠ˜å æ’ä»¶çš„æŠ˜å å›¾æ ‡ */
    .sidebar-nav li::before,
    .sidebar-nav li::after,
    .sidebar li::before,
    .sidebar li::after {
      content: '' !important;
      display: none !important;
      width: 0 !important;
      height: 0 !important;
      margin: 0 !important;
      padding: 0 !important;
      border: none !important;
    }
    
    /* æ›´å…·ä½“åœ°é’ˆå¯¹theme-simpleæ ·å¼ */
    .sidebar-nav ul li p::before,
    .sidebar-nav ul li a::before,
    .sidebar ul li p::before,
    .sidebar ul li a::before {
      content: '' !important;
      display: none !important;
    }
  </style>
</head>

<body>
  <div id="app"></div>
  
  <!-- å¼ºåˆ¶è¦†ç›–æ ·å¼ï¼šéšè—é»˜è®¤ç®­å¤´ -->
  <style>
    /* æœ€é«˜ä¼˜å…ˆçº§ï¼šéšè—æ‰€æœ‰é»˜è®¤çš„åˆ—è¡¨æ ‡è®°å’Œç®­å¤´ */
    aside.sidebar .sidebar-nav ul li::before,
    aside.sidebar .sidebar-nav ul li p::before,
    aside.sidebar .sidebar-nav ul li a::before {
      content: '' !important;
      display: none !important;
      visibility: hidden !important;
    }
  </style>

  <!-- ===================== Docsify æ ¸å¿ƒé…ç½® ===================== -->
  <script>
    window.$docsify = {
      /* å·¦ä¸Šè§’æ ‡é¢˜ä¸ä»“åº“å…¥å£ï¼ˆä¿æŒä½ çš„é…ç½®ï¼‰ */
      name: 'JoyRL',
      repo: 'https://github.com/datawhalechina/joyrl-book',

      /* å…³é”®ï¼šå¯ç”¨ä¾§è¾¹æ  + ç›¸å¯¹è·¯å¾„æ¨¡å¼ */
      loadSidebar: true,
      relativePath: true,   // âœ… å…è®¸åŸºäºå½“å‰æ–‡æ¡£ç›®å½•è§£æé“¾æ¥ä¸èµ„æº

      /* å¯é€‰ï¼šé™åˆ¶ä¾§è¾¹æ å±•ç¤ºå±‚çº§ */
      subMaxLevel: 4,

      /* ä¾§è¾¹æ æŠ˜å é…ç½® */
      sidebarDisplayLevel: 1, // è®¾ç½®ä¸º1ï¼Œå±•ç¤ºä¸€çº§èœå•ï¼Œå­èœå•å¯æŠ˜å 

      /* ä½ åœ¨ç”¨ docsify-latexï¼Œä½†æˆ‘ä»¬ä¹Ÿä¿ç•™ docsify åŸç”Ÿ markdown æ¸²æŸ“é…ç½®å…¥å£ */
      latex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$']],
      },

      /* ä½ åç»­çš„æ’ä»¶éƒ½ç»Ÿä¸€æ”¾åˆ° window.$docsify.plugins æ•°ç»„é‡Œï¼ˆè§ä¸‹æ–¹ç»Ÿä¸€åˆå¹¶çš„æ’ä»¶ï¼‰ */
      plugins: []
    };
  </script>

  <!-- ===================== è‡ªå®šä¹‰æ’ä»¶ï¼šå›¾ç‰‡è·¯å¾„ä¿®å¤ + MathJax åˆ‡æ¢é¡µé¢é‡ç½® + Giscus æ³¨å…¥ ===================== -->
  <script>
    /**
     * è¿™ä¸ªç»Ÿä¸€æ’ä»¶åšä¸‰ä»¶äº‹ï¼ˆé¡ºåºéå¸¸é‡è¦ï¼‰ï¼š
     * 1) beforeEachï¼šåœ¨å†…å®¹æ³¨å…¥å‰
     *    - æ¸…ç†/é‡ç½® MathJax çš„è®¡æ•°ä¸æ ‡ç­¾ç¼“å­˜ï¼ˆé˜²æ­¢ label multiply-definedï¼‰
     *    - å°†ã€Œç›¸å¯¹å›¾ç‰‡è·¯å¾„ figs/...ã€ä¿®æ­£ä¸ºã€ŒåŸºäºå½“å‰ md æ‰€åœ¨ç›®å½•çš„è·¯å¾„ã€
     *      ğŸ‘‰ æ”¯æŒ Markdown è¯­æ³• ![](figs/xxx.png) ä¸ HTML <img src="figs/...">
     * 2) doneEachï¼šå½“é¡µé¢æ¸²æŸ“å®Œ
     *    - é‡æ–° typeset æ•°å­¦å…¬å¼
     *    - æ ¹æ®å½“å‰ hash é‡æ–°æ³¨å…¥ Giscusï¼ˆä¸ä½ åŸå…ˆé€»è¾‘ä¸€è‡´ï¼Œä½†å°è£…åˆ° hereï¼‰
     * 3) å…¶ä½™åŠŸèƒ½ï¼ˆå¦‚è¿”å›é¡¶éƒ¨æŒ‰é’®ï¼‰ä¿æŒä½ åŸé€»è¾‘ï¼Œå¹¶å…¼å®¹ SPA åˆ‡æ¢
     */
    window.$docsify.plugins = [].concat(window.$docsify.plugins || [], function (hook, vm) {

      /* -------------------- å·¥å…·å‡½æ•°ï¼šå®‰å…¨æ¸…ç†å¹¶é‡ç½® MathJax -------------------- */
      function resetMathJax() {
        if (!window.MathJax) return;

        // v3/v4 å‡æ”¯æŒçš„å®‰å…¨è°ƒç”¨ï¼ˆå­˜åœ¨åˆ™æ‰§è¡Œï¼‰
        try { MathJax.typesetClear && MathJax.typesetClear(); } catch (e) {}
        try { MathJax.texReset && MathJax.texReset(); } catch (e) {}

        // è¿›ä¸€æ­¥å…œåº•ï¼ˆéƒ¨åˆ†ç‰ˆæœ¬å†…éƒ¨åŒ…åå˜åŠ¨ï¼Œè¿™é‡Œåšâ€œå°½åŠ›è€Œä¸ºâ€çš„æ¸…ç©ºï¼‰
        try {
          if (MathJax._ && MathJax._.tex && MathJax._.tex.Tags) {
            // éƒ¨åˆ†ç‰ˆæœ¬ä¸º reset / Resetï¼Œç»Ÿä¸€å°è¯•
            (MathJax._.tex.Tags.reset && MathJax._.tex.Tags.reset()) ||
            (MathJax._.tex.Tags.Reset && MathJax._.tex.Tags.Reset());
          }
        } catch (e) {}
      }

      /* -------------------- å·¥å…·å‡½æ•°ï¼šä¿®å¤å†…å®¹ä¸­çš„å›¾ç‰‡ç›¸å¯¹è·¯å¾„ -------------------- */
      function rewriteImagePaths(content) {
        /**
         * ç›®æ ‡ï¼šå…è®¸åœ¨ä»»æ„ç« èŠ‚ md é‡Œç”¨æœ€çŸ­å†™æ³•
         *   - Markdown: ![](figs/a.png)  ->  è‡ªåŠ¨å˜ä¸º  ch7/figs/a.pngï¼ˆå¦‚æœå½“å‰åœ¨ ch7/xxx.mdï¼‰
         *   - HTML:     <img src="figs/a.png"> -> åŒä¸Š
         *
         * æ³¨æ„ï¼š
         * - ä¸å¤„ç†ä»¥ http(s):// å¼€å¤´ã€ä»¥ data:ã€ä»¥ ./ æˆ– ../ å¼€å¤´ã€ä»¥ / å¼€å¤´çš„è·¯å¾„
         * - åªå¤„ç†ä»¥ "figs/" å¼€å¤´çš„ã€Œçº¯ç›¸å¯¹ã€çŸ­è·¯å¾„
         */
        var file = vm.route.file || ''; // ä¾‹å¦‚ "ch9/main.md"
        var dir  = file ? file.substring(0, file.lastIndexOf('/')) : ''; // "ch9"
        var prefix = dir ? (dir + '/') : '';

        // 1) ä¿®å¤ HTML <img src="figs/..."> â€”â€” ä¿æŒå…¶å®ƒå±æ€§ä¸å˜ï¼Œå°½é‡ä¸¥è°¨åŒ¹é…
        content = content.replace(
          /(<img\b[^>]*?\bsrc\s*=\s*["'])(figs\/[^"']*)(["'][^>]*>)/gi,
          function (_, pre, src, post) {
            // è·³è¿‡ç‰¹æ®Šå‰ç¼€
            if (/^(?:https?:|data:|\/|\.\/|\.\.\/)/i.test(src)) return pre + src + post;
            return pre + prefix + src + post; // åŠ ä¸Šå½“å‰ç›®å½•å‰ç¼€
          }
        );

        // 2) ä¿®å¤ Markdown ![alt](figs/xxx.png) â€”â€” æ³¨æ„ alt å†…å¯èƒ½æœ‰å­—ç¬¦ï¼Œéè´ªå©ªåŒ¹é…
        content = content.replace(
          /(!\[[^\]]*?\]\()(\s*figs\/[^)]+)(\))/gi,
          function (_, pre, src, post) {
            // è·³è¿‡ç‰¹æ®Šå‰ç¼€
            if (/^(?:\s*(?:https?:|data:|\/|\.\/|\.\.\/))/i.test(src)) return pre + src + post;
            // å»é™¤å¼€å¤´çš„ç©ºæ ¼ï¼ˆå¦‚æœæœ‰ï¼‰ï¼Œå†æ‹¼æ¥å‰ç¼€
            var cleaned = src.replace(/^\s+/, '');
            return pre + prefix + cleaned + post;
          }
        );

        return content;
      }

      /* -------------------- ç”Ÿå‘½å‘¨æœŸï¼šå†…å®¹æ³¨å…¥å‰ -------------------- */
      hook.beforeEach(function (content) {
        // â‘  åˆ‡æ¢é¡µé¢å‰ï¼šæ¸…ç† MathJaxï¼Œé¿å… label å¤šæ¬¡å®šä¹‰
        resetMathJax();

        // â‘¡ åœ¨ md æ³¨å…¥å‰ï¼Œé‡å†™å›¾ç‰‡è·¯å¾„
        content = rewriteImagePaths(content);

        return content;
      });

      /* -------------------- ç”Ÿå‘½å‘¨æœŸï¼šé¡µé¢æ¸²æŸ“å®Œæˆå -------------------- */
      hook.doneEach(function () {
        // â‘¢ æ¸²æŸ“å®Œæˆåï¼šé‡æ–° typeset æ•°å­¦å…¬å¼
        if (window.MathJax && MathJax.typesetPromise) {
          MathJax.typesetPromise();
        }

        // â‘£ æ¯æ¬¡é¡µé¢åˆ‡æ¢ï¼šé‡æ–°æ¸²æŸ“/æ³¨å…¥ Giscusï¼ˆä¸ä½ åŸé€»è¾‘ä¿æŒä¸€è‡´ï¼‰
        try {
          var giscusId = 'giscus-comments';
          var section = document.querySelector('.markdown-section');

          // ç§»é™¤æ—§çš„è¯„è®ºåŒº
          var old = document.getElementById(giscusId);
          if (old) old.remove();

          // åŸºäºå½“å‰ hash ä½œä¸ºè®¨è®ºä¸»é¢˜ key
          var hashPath = location.hash ? location.hash.replace(/^#\/?/, '') : 'home';

          if (section) {
            var giscusDiv = document.createElement('div');
            giscusDiv.id = giscusId;
            section.appendChild(giscusDiv);

            var script = document.createElement('script');
            script.src = 'https://giscus.app/client.js';
            script.setAttribute('data-repo', 'datawhalechina/joyrl-book');
            script.setAttribute('data-repo-id', 'R_kgDOJQd2zw');
            script.setAttribute('data-category', 'Q&A');
            script.setAttribute('data-category-id', 'DIC_kwDOJQd2z84Cwt-N');
            script.setAttribute('data-mapping', 'specific'); // ä½¿ç”¨è‡ªå®šä¹‰ term
            script.setAttribute('data-term', hashPath);
            script.setAttribute('data-strict', '0');
            script.setAttribute('data-reactions-enabled', '1');
            script.setAttribute('data-emit-metadata', '0');
            script.setAttribute('data-input-position', 'bottom');
            script.setAttribute('data-theme', 'light');
            script.setAttribute('data-lang', 'zh-CN');
            script.setAttribute('crossorigin', 'anonymous');
            script.async = true;
            giscusDiv.appendChild(script);
          }
        } catch (e) {
          // å¿½ç•¥ Giscus æ³¨å…¥å¤±è´¥
          console.warn('Giscus inject failed:', e);
        }

        // â‘¤ åŒæ­¥å¤„ç†â€œè¿”å›é¡¶éƒ¨â€æŒ‰é’®åœ¨ SPA åˆ‡æ¢åçš„å¯è§æ€§
        var topBtn = document.getElementById('back-to-top');
        if (topBtn) {
          topBtn.style.display = (window.scrollY > 200) ? 'block' : 'none';
        }
      });
    });
  </script>

  <!-- ===================== Docsify æ ¸å¿ƒ & å¸¸ç”¨æ’ä»¶ ===================== -->
  <script src="https://cdn.jsdelivr.net/npm/docsify@4"></script>
  <script src="https://cdn.jsdelivr.net/npm/docsify@4/lib/plugins/search.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/docsify-pagination/dist/docsify-pagination.min.js"></script>
  <!-- ä¾§è¾¹æ æŠ˜å æ’ä»¶ -->
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/docsify-sidebar-collapse/dist/sidebar.min.css" />
  <script src="//cdn.jsdelivr.net/npm/docsify-sidebar-collapse/dist/docsify-sidebar-collapse.min.js"></script>

  <!-- è‡ªåŠ¨ç¼–å·çš„ MathJax é…ç½® -->
  <script>
    /**
     * MathJax v4 é…ç½®ï¼š
     * - å¯ç”¨ ams/amsmath/bm åŒ…
     * - tags: 'ams' å¼€å¯è‡ªåŠ¨ç¼–å·ï¼ˆé…åˆæˆ‘ä»¬åœ¨ beforeEach çš„ reset é¿å…é‡å¤å®šä¹‰ï¼‰
     * - è·³è¿‡ code/pre ç­‰åŒºå—
     */
    window.MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$']],
        processEscapes: true,
        packages: {'[+]': ['ams','amsmath','bm']},
        tags: 'ams',         // âœ… è‡ªåŠ¨ç¼–å·æ‰€æœ‰å…¬å¼
        // tagSide: 'right',
        // tagIndent: '0em',
        options: {
          skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      }
    };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@4/tex-mml-chtml.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/docsify-latex@0"></script>

  <!-- ä»£ç å¤åˆ¶æŒ‰é’® -->
  <script src="https://cdn.jsdelivr.net/npm/docsify-copy-code"></script>

  <!-- =============== Giscus è¯„è®ºç³»ç»Ÿ =============== -->
  <!-- <div id="giscus-comments">
    <script src="https://giscus.app/client.js"
      data-repo="datawhalechina/joyrl-book"
      data-repo-id="R_kgDOJQd2zw"
      data-category="Q&A"
      data-category-id="DIC_kwDOJQd2z84Cwt-N"
      data-mapping="pathname"
      data-strict="0"
      data-reactions-enabled="1"
      data-emit-metadata="0"
      data-input-position="bottom"
      data-theme="light"
      data-lang="zh-CN"
      crossorigin="anonymous"
      async>
    </script>
  </div> -->
  <!-- è¿”å›é¡¶éƒ¨æŒ‰é’® -->
  <button id="back-to-top" style="display:none;position:fixed;right:32px;bottom:32px;z-index:99;padding:10px 18px;border-radius:24px;background:#4f6ef7;color:#fff;border:none;box-shadow:0 2px 8px rgba(0,0,0,0.15);font-size:16px;cursor:pointer;transition:opacity 0.2s;">â†‘ é¡¶éƒ¨</button>
  <script>
    // è¿”å›é¡¶éƒ¨æŒ‰é’®é€»è¾‘
    var topBtn = document.getElementById('back-to-top');
    window.addEventListener('scroll', function() {
      topBtn.style.display = (window.scrollY > 200) ? 'block' : 'none';
    });
    topBtn.onclick = function() {
      window.scrollTo({top:0,behavior:'smooth'});
    };
    // Docsify SPA é¡µé¢åˆ‡æ¢åä¹Ÿè¦é‡ç½®æŒ‰é’®
    if (window.$docsify) {
      if (!window.__topbtn_hooked) {
        window.__topbtn_hooked = true;
        window.$docsify.plugins = (window.$docsify.plugins || []);
        window.$docsify.plugins.push(function(hook) {
          hook.doneEach(function() {
            topBtn.style.display = (window.scrollY > 200) ? 'block' : 'none';
          });
        });
      }
    }
  </script>

</body>
</html>
