<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>JoyRL 文档</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="description" content="JoyRL 文档">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">

  <!-- Docsify 主题（亮/暗） -->
  <link rel="stylesheet" media="(prefers-color-scheme: dark)" href="https://cdn.jsdelivr.net/npm/docsify-themeable@0/dist/css/theme-simple-dark.css">
  <link rel="stylesheet" media="(prefers-color-scheme: light)" href="https://cdn.jsdelivr.net/npm/docsify-themeable@0/dist/css/theme-simple.css">

  <style>
    /* =============== 基础主题调整 =============== */
    :root {
      /* 可根据喜好调整主题色 */
      /* --theme-hue: 325; */
    }

    /* =============== Giscus 布局修复 =============== */
    /* 评论容器与正文对齐居中 */
    #giscus-comments {
      max-width: 800px;
      width: 100%;
      margin: 2em auto;
      padding: 0;
      box-sizing: border-box;
      display: block;
      position: relative;
      z-index: 0;
    }

    /* 确保左侧目录浮在上层 */
    .sidebar,
    .sidebar-toggle,
    .docsify-toc {
      position: relative;
      z-index: 20 !important;
    }

    /* 降低 Giscus 层级，防止遮挡目录 */
    .giscus,
    .giscus-frame {
      position: relative !important;
      z-index: 0 !important;
    }

    /* 小屏幕自适应 */
    @media (max-width: 900px) {
      #giscus-comments {
        width: 100%;
        margin: 1.5em 0.5em;
      }
    }

    /* 优化公式显示 */
    mjx-container[jax="SVG"][display="true"] {
      text-align: center;
      margin: 1em 0;
    }
  </style>
</head>

<body>
  <div id="app"></div>

  <script>
    window.$docsify = {
      name: 'JoyRL',
      repo: 'https://github.com/datawhalechina/joyrl-book',

      loadSidebar: true,
      elativePath: true,
      subMaxLevel: 4,

      latex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$']],
      },

      plugins: [
        function (hook) {
          // figs 在根目录下
          // hook.beforeEach(function (content) {
          //   // 修复图片路径
          //   return content.replace(/..\/figs/g, "figs");
          // });

          hook.doneEach(function () {
            // 页面切换后重新渲染公式
            if (window.MathJax) window.MathJax.typesetPromise();

            // 自动插入 Giscus 评论区到正文内容区，确保每次页面切换都刷新
            var giscusId = 'giscus-comments';
            var section = document.querySelector('.markdown-section');
            // 移除旧的评论区
            var oldGiscus = document.getElementById(giscusId);
            if (oldGiscus) oldGiscus.remove();
            // 获取当前 hash 路径作为唯一标识
            var hashPath = location.hash ? location.hash.replace(/^#\/?/, '') : 'home';
            // 插入新的评论区
            if (section) {
              var giscusDiv = document.createElement('div');
              giscusDiv.id = giscusId;
              section.appendChild(giscusDiv);
              var script = document.createElement('script');
              script.src = 'https://giscus.app/client.js';
              script.setAttribute('data-repo', 'datawhalechina/joyrl-book');
              script.setAttribute('data-repo-id', 'R_kgDOJQd2zw');
              script.setAttribute('data-category', 'Q&A');
              script.setAttribute('data-category-id', 'DIC_kwDOJQd2z84Cwt-N');
              script.setAttribute('data-mapping', 'specific');
              script.setAttribute('data-term', hashPath);
              script.setAttribute('data-strict', '0');
              script.setAttribute('data-reactions-enabled', '1');
              script.setAttribute('data-emit-metadata', '0');
              script.setAttribute('data-input-position', 'bottom');
              script.setAttribute('data-theme', 'light');
              script.setAttribute('data-lang', 'zh-CN');
              script.setAttribute('crossorigin', 'anonymous');
              script.async = true;
              giscusDiv.appendChild(script);
            }
          });
        }
      ]
    };
  </script>
  <script>
    // ✅ 自动修复 Markdown/HTML 图片路径，支持相对路径 figs/xxx.png
    window.$docsify.plugins = [].concat(window.$docsify.plugins || [], function (hook, vm) {
      hook.beforeEach(function (content) {
        const file = vm.route.file; // 如 ch9/main.md
        const dir = file ? file.substring(0, file.lastIndexOf('/')) : '';

        // ✅ 修复 HTML 写法 <img src="figs/...">
        content = content.replace(/src="figs\//g, `src="${dir}/figs/`);

        // ✅ 修复 Markdown 写法 ![](figs/...)
        content = content.replace(/!\[(.*?)\]\(figs\//g, `![$1](${dir}/figs/`);

        return content;
      });
    });
  </script>



  <!-- Docsify 核心 -->
  <script src="//cdn.jsdelivr.net/npm/docsify@4"></script>

  <!-- 搜索与分页插件 -->
  <script src="//cdn.jsdelivr.net/npm/docsify@4/lib/plugins/search.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/docsify-pagination/dist/docsify-pagination.min.js"></script>

  <!-- 自动编号的 MathJax 配置 -->
  <script>
    window.MathJax = {
      tex: {
        
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$']],
        processEscapes: true,
        packages: {'[+]': ['ams','amsmath','bm']},
        tags: 'ams',         // ✅ 自动编号所有公式
        // tagSide: 'right',
        // tagIndent: '0em',
        options: {
          skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
        }
      }
    };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@4/tex-mml-chtml.js"></script>
  <script src="//cdn.jsdelivr.net/npm/docsify-latex@0"></script>

  <!-- 代码复制按钮 -->
  <script src="//cdn.jsdelivr.net/npm/docsify-copy-code"></script>

  <!-- =============== Giscus 评论系统 =============== -->
  <!-- <div id="giscus-comments">
    <script src="https://giscus.app/client.js"
      data-repo="datawhalechina/joyrl-book"
      data-repo-id="R_kgDOJQd2zw"
      data-category="Q&A"
      data-category-id="DIC_kwDOJQd2z84Cwt-N"
      data-mapping="pathname"
      data-strict="0"
      data-reactions-enabled="1"
      data-emit-metadata="0"
      data-input-position="bottom"
      data-theme="light"
      data-lang="zh-CN"
      crossorigin="anonymous"
      async>
    </script>
  </div> -->
  <!-- 返回顶部按钮 -->
  <button id="back-to-top" style="display:none;position:fixed;right:32px;bottom:32px;z-index:99;padding:10px 18px;border-radius:24px;background:#4f6ef7;color:#fff;border:none;box-shadow:0 2px 8px rgba(0,0,0,0.15);font-size:16px;cursor:pointer;transition:opacity 0.2s;">↑ 顶部</button>
  <script>
    // 返回顶部按钮逻辑
    var topBtn = document.getElementById('back-to-top');
    window.addEventListener('scroll', function() {
      topBtn.style.display = (window.scrollY > 200) ? 'block' : 'none';
    });
    topBtn.onclick = function() {
      window.scrollTo({top:0,behavior:'smooth'});
    };
    // Docsify SPA 页面切换后也要重置按钮
    if (window.$docsify) {
      if (!window.__topbtn_hooked) {
        window.__topbtn_hooked = true;
        window.$docsify.plugins = (window.$docsify.plugins || []);
        window.$docsify.plugins.push(function(hook) {
          hook.doneEach(function() {
            topBtn.style.display = (window.scrollY > 200) ? 'block' : 'none';
          });
        });
      }
    }
  </script>
</body>
</html>
